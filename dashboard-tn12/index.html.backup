<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kaspa TN12 Contract Playground</title>
    <style>
        :root {
            --bg-primary: #000000;
            --bg-card: #0a0a0a;
            --bg-card-hover: #111111;
            --bg-input: #050505;
            --accent: #00ff88;
            --accent-dim: #005533;
            --accent-glow: rgba(0, 255, 136, 0.15);
            --text: #e0e0e0;
            --text-muted: #404040;
            --border: #1a1a1a;
            --border-hover: #2a2a2a;
            --error: #ff4444;
            --warning: #ffaa00;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', monospace;
            background: var(--bg-primary);
            color: var(--text);
            min-height: 100vh;
            font-size: 13px;
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 24px; }
        header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 20px 0; border-bottom: 1px solid var(--border); margin-bottom: 32px;
        }
        .logo { display: flex; align-items: center; gap: 12px; }
        .logo h1 { font-size: 18px; font-weight: 600; }
        .logo-dot { width: 8px; height: 8px; background: var(--accent); border-radius: 50%; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
        .network-badge { background: var(--bg-card); border: 1px solid var(--border); padding: 6px 14px; border-radius: 4px; font-size: 11px; color: var(--text-muted); }
        .network-badge span { color: var(--accent); }
        
        /* Balance Display */
        .balance-display { background: var(--bg-input); padding: 16px; border-radius: 6px; border: 1px solid var(--border); margin-bottom: 24px; display: flex; justify-content: space-between; align-items: center; }
        .balance-label { font-size: 11px; color: var(--text-muted); }
        .balance-value { font-size: 20px; font-weight: 600; color: var(--accent); }
        
        /* Two Panel Layout */
        .cli-panel { display: grid; grid-template-columns: 280px 1fr; min-height: 500px; gap: 0; border: 1px solid var(--border); border-radius: 8px; overflow: hidden; }
        .cli-sidebar { background: var(--bg-card); border-right: 1px solid var(--border); padding: 16px; overflow-y: auto; }
        .cli-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid var(--border); }
        .cli-header span { font-size: 12px; font-weight: 600; }
        .cli-output { background: #0a0a0a; display: flex; flex-direction: column; }
        .cli-output-header { padding: 10px 16px; border-bottom: 1px solid var(--border); font-size: 10px; color: var(--text-muted); display: flex; justify-content: space-between; align-items: center; text-transform: uppercase; letter-spacing: 0.1em; background: #111; }
        .cli-output-header button { background: none; border: 1px solid var(--border); color: var(--text-muted); padding: 4px 10px; border-radius: 3px; font-size: 10px; cursor: pointer; font-family: inherit; }
        .cli-output-header button:hover { border-color: var(--accent); color: var(--accent); }
        .cli-content { flex: 1; padding: 16px; overflow-y: auto; font-family: 'SF Mono', monospace; font-size: 11px; line-height: 1.6; }
        
        /* Category Headers */
        .cat-header { font-size: 10px; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-muted); padding: 12px 0 6px 0; margin-top: 12px; border-top: 1px solid var(--border); }
        .cat-header:first-child { margin-top: 0; border-top: none; padding-top: 0; }
        
        /* Command Buttons */
        .cmd-btns { display: flex; flex-wrap: wrap; gap: 6px; }
        .chip-btn { padding: 6px 12px; background: var(--bg-input); border: 1px solid var(--border); border-radius: 4px; color: var(--text); font-family: inherit; font-size: 10px; cursor: pointer; transition: all 0.15s; text-transform: uppercase; }
        .chip-btn:hover { border-color: var(--accent); color: var(--accent); }
        .chip-btn:active { background: var(--accent); border-color: var(--accent); color: #000; }
        
        /* Output Styles */
        .cli-content .cmd { color: var(--text); margin-bottom: 4px; }
        .cli-content .cmd::before { content: '$ '; color: var(--accent); }
        .cli-content .result { color: var(--accent); white-space: pre-wrap; word-break: break-all; margin-bottom: 12px; padding-left: 16px; border-left: 2px solid var(--border); }
        .cli-content .error { color: var(--error); margin-bottom: 12px; }
        .cli-content .info { color: var(--text-muted); margin-bottom: 12px; font-style: italic; }
        
        /* Toast */
        .toast { position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%) translateY(100px); background: var(--accent); color: #000; padding: 10px 20px; border-radius: 4px; font-size: 12px; opacity: 0; transition: all 0.3s; z-index: 1000; }
        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-primary); }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo"><div class="logo-dot"></div><h1>KASPA TN12 CONTRACT PLAYGROUND</h1></div>
            <div class="network-badge">NETWORK: <span>TESTNET 12</span></div>
        </header>

        <div class="balance-display">
            <div>
                <div class="balance-label">WALLET BALANCE</div>
                <div class="balance-value" id="walletBalance">10,000.00 TKAS</div>
            </div>
            <button class="chip-btn" onclick="refreshBalance()">↻ Refresh</button>
        </div>

        <div class="cli-panel">
            <div class="cli-sidebar">
                <div class="cli-header">
                    <span>CLI COMMANDS</span>
                </div>
                <div id="chipButtons"></div>
            </div>
            <div class="cli-output">
                <div class="cli-output-header">
                    <span>OUTPUT TERMINAL</span>
                    <button onclick="clearOutput()">⌫ Clear</button>
                </div>
                <div class="cli-content" id="cliOutput">
                    <div class="info">Click a command button to see output...</div>
                </div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast">Copied!</div>

    <script>
        const API_BASE = 'https://api-tn12.kaspa.org';
        const TEST_WALLET = {
            privateKey: '89e4494523767f2eff234e7a2ecf7409edd90ea5f97ca32fbdbfb1dc4314e040',
            address: 'kaspatest:qq4lj67dwyywtgegsfd2rvaugudxwur3uyp48563zy03ha2smwlhxma2kafj0'
        };

        const COMMANDS = {
            'generate': { desc: 'Generate new wallet', params: [], cli: 'kaspa-graffiti-cli generate' },
            'balance': { desc: 'Check TN12 balance', params: [{name: 'address', default: TEST_WALLET.address}], api: (a) => API_BASE + '/addresses/' + encodeURIComponent(a[0] || TEST_WALLET.address) + '/balance', cli: 'kaspa-graffiti-cli balance <address>' },
            'utxos': { desc: 'List UTXOs', params: [{name: 'address', default: TEST_WALLET.address}], api: (a) => API_BASE + '/addresses/' + encodeURIComponent(a[0] || TEST_WALLET.address) + '/utxos', cli: 'kaspa-graffiti-cli utxos <address>' },
            'transfer': { desc: 'Transfer KAS', params: [{name: 'private_key', default: TEST_WALLET.privateKey}, {name: 'recipient', default: ''}, {name: 'amount', default: '1'}], cli: 'kaspa-graffiti-cli transfer <key> <addr> <amount>' },
            'load': { desc: 'Load wallet', params: [{name: 'private_key', default: ''}], cli: 'kaspa-graffiti-cli load <private_key>' },
            'hd-generate': { desc: 'Generate HD wallet', params: [], cli: 'kaspa-graffiti-cli hd-generate' },
            'hd-load': { desc: 'Load HD wallet', params: [{name: 'seed', default: ''}], cli: 'kaspa-graffiti-cli hd-load <seed>' },
            'derive-address': { desc: 'Derive address', params: [{name: 'seed', default: ''}, {name: 'index', default: '0'}], cli: 'kaspa-graffiti-cli derive-address <seed> <index>' },
            'deadman-deploy': { desc: 'Deploy deadman', params: [{name: 'private_key', default: TEST_WALLET.privateKey}, {name: 'beneficiary', default: ''}, {name: 'timeout', default: '300'}], cli: 'kaspa-graffiti-cli transfer <key> <addr> <amount>' },
            'deadman-heartbeat': { desc: 'Heartbeat', params: [{name: 'private_key', default: TEST_WALLET.privateKey}], cli: 'kaspa-graffiti-cli transfer <key> <addr> <amount>' },
            'deploy-contract': { desc: 'Deploy contract', params: [{name: 'contract', default: 'deadman'}], cli: 'cd ~/kaspa-node && ./deploy_contract.sh <contract> <key>' }
        };

        const CATEGORIES = {
            'WALLET': ['generate', 'balance', 'utxos', 'transfer', 'load'],
            'HD WALLET': ['hd-generate', 'hd-load', 'derive-address'],
            'DEADMAN': ['deadman-deploy', 'deadman-heartbeat'],
            'CONTRACT': ['deploy-contract']
        };

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 2000);
        }

        function renderButtons() {
            const container = document.getElementById('chipButtons');
            Object.entries(CATEGORIES).forEach(([cat, cmds]) => {
                const header = document.createElement('div');
                header.className = 'cat-header';
                header.textContent = cat;
                container.appendChild(header);
                const div = document.createElement('div');
                div.className = 'cmd-btns';
                cmds.forEach(cmd => {
                    const btn = document.createElement('button');
                    btn.className = 'chip-btn';
                    btn.textContent = cmd;
                    btn.onclick = () => runCommand(cmd);
                    div.appendChild(btn);
                });
                container.appendChild(div);
            });
        }

        async function runCommand(cmdName) {
            const cmd = COMMANDS[cmdName];
            const output = document.getElementById('cliOutput');
            
            let args = cmd.params.map((p, i) => p.default);
            
            // Build CLI display
            const cliCmd = cmd.cli;
            output.innerHTML = '<div class="cmd">' + cliCmd + '</div>';
            
            try {
                if (cmd.api) {
                    const url = cmd.api(args);
                    const res = await fetch(url);
                    const data = await res.json();
                    output.innerHTML += '<div class="result">' + JSON.stringify(data, null, 2) + '</div>';
                } else {
                    output.innerHTML += '<div class="info">CLI: ' + cmd.cli + '\n\nRun this command in terminal with kgraf3:\n~/kgraf3/target/release/kaspa-graffiti-cli ' + cmdName + '</div>';
                }
            } catch (e) {
                output.innerHTML += '<div class="error">Error: ' + e.message + '</div>';
            }
            output.scrollTop = output.scrollHeight;
        }

        function clearOutput() {
            document.getElementById('cliOutput').innerHTML = '<div class="info">Click a command button to see output...</div>';
        }

        async function refreshBalance() {
            try {
                const res = await fetch(API_BASE + '/addresses/' + TEST_WALLET.address + '/balance');
                const data = await res.json();
                document.getElementById('walletBalance').textContent = (parseInt(data.balance) / 100000000).toFixed(2) + ' TKAS';
                showToast('Balance refreshed');
            } catch (e) {
                showToast('Error: ' + e.message);
            }
        }

        renderButtons();
        refreshBalance();
    </script>
</body>
</html>
