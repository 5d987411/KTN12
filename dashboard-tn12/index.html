<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KASPA Testnet 12</title>
    <style>
        :root {
            --bg-primary: #000000;
            --bg-card: #0a0a0a;
            --bg-card-hover: #111111;
            --bg-input: #050505;
            --accent: #00ff88;
            --accent-dim: #005533;
            --accent-glow: rgba(0, 255, 136, 0.15);
            --text: #e0e0e0;
            --text-muted: #404040;
            --border: #1a1a1a;
            --border-hover: #2a2a2a;
            --error: #ff4444;
            --warning: #ffaa00;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', monospace;
            background: var(--bg-primary);
            color: var(--text);
            min-height: 100vh;
            font-size: 13px;
        }
        .container { max-width: 1600px; margin: 0 auto; padding: 24px; }
        header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 20px 0; border-bottom: 1px solid var(--border); margin-bottom: 32px;
        }
        .logo { display: flex; align-items: center; gap: 12px; }
        .logo h1 { font-size: 18px; font-weight: 600; }
        .logo-dot { width: 8px; height: 8px; background: var(--accent); border-radius: 50%; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
        .network-badge { background: var(--bg-card); border: 1px solid var(--border); padding: 6px 14px; border-radius: 4px; font-size: 11px; color: var(--text-muted); }
        .network-badge span { color: var(--accent); }
        
        /* Balance Display */
        .balance-display { background: var(--bg-input); padding: 16px; border-radius: 6px; border: 1px solid var(--border); margin-bottom: 24px; display: flex; justify-content: space-between; align-items: center; }
        .balance-label { font-size: 11px; color: var(--text-muted); }
        .balance-value { font-size: 20px; font-weight: 600; color: var(--accent); }
        
        /* Three Panel Layout */
        .cli-panel { display: grid; grid-template-columns: 220px 280px 1fr; min-height: 500px; gap: 0; border: 1px solid var(--border); border-radius: 8px; overflow: hidden; }
        
        /* Left Panel - Commands */
        .cli-sidebar { background: var(--bg-card); border-right: 1px solid var(--border); padding: 16px; overflow-y: auto; }
        .cli-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid var(--border); }
        .cli-header span { font-size: 12px; font-weight: 600; }
        
        /* Middle Panel - Parameters */
        .cli-params { background: var(--bg-input); border-right: 1px solid var(--border); padding: 16px; overflow-y: auto; }
        .params-header { font-size: 11px; font-weight: 600; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid var(--border); color: var(--accent); }
        .param-group { margin-bottom: 12px; }
        .param-label { font-size: 10px; color: var(--text-muted); margin-bottom: 4px; text-transform: uppercase; }
        .param-input { width: 100%; padding: 8px 10px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 4px; color: var(--text); font-family: inherit; font-size: 11px; }
        .param-input:focus { outline: none; border-color: var(--accent); }
        .run-btn { width: 100%; padding: 10px; background: var(--accent); border: none; border-radius: 4px; color: #000; font-family: inherit; font-size: 12px; font-weight: 600; cursor: pointer; margin-top: 8px; }
        .run-btn:hover { background: #00cc6a; }
        
        /* Right Panel - Output */
        .cli-output { background: #0a0a0a; display: flex; flex-direction: column; }
        .cli-output-header { padding: 10px 16px; border-bottom: 1px solid var(--border); font-size: 10px; color: var(--text-muted); display: flex; justify-content: space-between; align-items: center; text-transform: uppercase; letter-spacing: 0.1em; background: #111; }
        .cli-output-header button { background: none; border: 1px solid var(--border); color: var(--text-muted); padding: 4px 10px; border-radius: 3px; font-size: 10px; cursor: pointer; font-family: inherit; }
        .cli-output-header button:hover { border-color: var(--accent); color: var(--accent); }
        .cli-content { flex: 1; padding: 16px; overflow-y: auto; font-family: 'SF Mono', monospace; font-size: 11px; line-height: 1.6; }
        
        /* Category Headers */
        .cat-header { font-size: 10px; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-muted); padding: 12px 0 6px 0; margin-top: 12px; border-top: 1px solid var(--border); }
        .cat-header:first-child { margin-top: 0; border-top: none; padding-top: 0; }
        
        /* Command Buttons - Single Column like old explorers */
        .cmd-btns { display: flex; flex-direction: column; gap: 4px; }
        .chip-btn { padding: 8px 12px; background: var(--bg-input); border: 1px solid var(--border); border-radius: 4px; color: var(--text); font-family: inherit; font-size: 10px; cursor: pointer; transition: all 0.15s; text-transform: uppercase; text-align: left; }
        .chip-btn:hover { border-color: var(--accent); color: var(--accent); }
        .chip-btn:active { background: var(--accent); border-color: var(--accent); color: #000; }
        
        /* Output Styles */
        .cli-content .cmd { color: var(--text); margin-bottom: 4px; }
        .cli-content .cmd::before { content: '$ '; color: var(--accent); }
        .cli-content .result { color: var(--accent); white-space: pre-wrap; word-break: break-all; margin-bottom: 12px; padding-left: 16px; border-left: 2px solid var(--border); }
        .cli-content .error { color: var(--error); margin-bottom: 12px; }
        .cli-content .info { color: var(--text-muted); margin-bottom: 12px; font-style: italic; }
        
        /* Toast */
        .toast { position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%) translateY(100px); background: var(--accent); color: #000; padding: 10px 20px; border-radius: 4px; font-size: 12px; opacity: 0; transition: all 0.3s; z-index: 1000; }
        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-primary); }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo"><div class="logo-dot"></div><h1>KASPA Testnet 12</h1><span id="datetime" style="margin-left: 20px; color: var(--text-muted); font-size: 12px;"></span></div>
            <div class="network-badge">NETWORK: <span>TESTNET 12</span></div>
        </header>

        <div class="balance-display">
            <div>
                <div class="balance-label">ADDRESS</div>
                <div class="balance-value" id="walletAddress" style="font-size: 11px;">kaspatest:qq4lj67dwyywtgegsfd2rvaugudxwur3uyp48563zy03ha2smwlhxma2kafj0</div>
                <div class="balance-label" style="margin-top: 12px;">WALLET BALANCE</div>
                <div class="balance-value" id="walletBalance">10,000.00 TKAS</div>
            </div>
            <button class="chip-btn" onclick="refreshBalance()">↻ Refresh</button>
        </div>

        <div class="cli-panel">
            <!-- Left Panel - Commands -->
            <div class="cli-sidebar">
                <div class="cli-header">
                    <span>CLI COMMANDS</span>
                </div>
                <div id="chipButtons"></div>
            </div>
            
            <!-- Middle Panel - Parameters -->
            <div class="cli-params">
                <div class="params-header" id="paramsHeader">PARAMETERS</div>
                <div id="paramsForm">
                    <div class="info">Select a command</div>
                </div>
            </div>
            
            <!-- Right Panel - Output -->
            <div class="cli-output">
                <div class="cli-output-header">
                    <span>OUTPUT TERMINAL</span>
                    <button onclick="clearOutput()">⌫ Clear</button>
                </div>
                <div class="cli-content" id="cliOutput">
                    <div class="info">Click a command, fill params, click RUN...</div>
                </div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast">Copied!</div>

    <script>
        const API_BASE = 'https://api-tn12.kaspa.org';
        const LOCAL_API = 'http://localhost:3001/api';
        const RPC_URL = 'https://api-tn12.kaspa.org';
        const KGRAF3_BIN = '~/kgraf3/target/release/kaspa-graffiti-cli';
        
        const TEST_WALLET = {
            privateKey: 'b23f42d4a5f9c2963f4b73403f7efcb12b28983f808f0092b43da55ee53317e7',
            publicKey: '031b16cc186e03e4416757ddf67cf6d4836408d04747a8bf8eca07860ce9d449cf',
            address: 'kaspatest:qqd3dnqcdcp7gst82lwlvl8k6jpkgzxsgar630uwegrcvr8f63yu7yftcxsen'
        };

        let currentCmd = null;

        const COMMANDS = {
            'generate': { 
                desc: 'Generate new wallet', 
                params: [], 
                api: LOCAL_API + '/run-cmd',
                method: 'POST',
                body: () => ({ cmd: 'generate' }),
                cli: KGRAF3_BIN + ' generate' 
            },
            'balance-tn12': { 
                desc: 'Check TN12 balance', 
                params: [{name: 'address', default: ''}], 
                api: API_BASE + '/addresses/' + encodeURIComponent(TEST_WALLET.address) + '/balance',
                method: 'GET',
                cli: KGRAF3_BIN + ' balance <address>' 
            },
            'balance-tn10': { 
                desc: 'Check TN10 balance', 
                params: [{name: 'address', default: TEST_WALLET.address}], 
                api: 'https://api-tn10.kaspa.org/addresses/' + encodeURIComponent(TEST_WALLET.address) + '/balance',
                method: 'GET',
                cli: KGRAF3_BIN + ' balance <address> --rpc https://api-tn10.kaspa.org' 
            },
            'utxos': { 
                desc: 'List UTXOs', 
                params: [{name: 'address', default: TEST_WALLET.address}], 
                api: API_BASE + '/addresses/' + encodeURIComponent(TEST_WALLET.address) + '/utxos',
                method: 'GET',
                cli: KGRAF3_BIN + ' utxos <address>' 
            },
            'send': { 
                desc: 'Transfer KAS', 
                params: [
                    {name: 'private_key', default: TEST_WALLET.privateKey}, 
                    {name: 'recipient', default: ''}, 
                    {name: 'amount', default: '1'}
                ], 
                api: LOCAL_API + '/transfer',
                method: 'POST',
                body: (args) => ({ privateKey: args[0], recipient: args[1], amount: args[2] }),
                cli: KGRAF3_BIN + ' transfer <private_key> <recipient> <amount>' 
            },
            'load': { 
                desc: 'Load wallet', 
                params: [{name: 'private_key', default: ''}], 
                api: LOCAL_API + '/run-cmd',
                method: 'POST',
                body: (args) => ({ cmd: 'load ' + args[0] }),
                cli: KGRAF3_BIN + ' load <private_key>' 
            },
            'send': { 
                desc: 'Send KAS', 
                params: [
                    {name: 'private_key', default: TEST_WALLET.privateKey}, 
                    {name: 'recipient', default: ''}, 
                    {name: 'amount', default: '1'}
                ], 
                api: LOCAL_API + '/run-cmd',
                method: 'POST',
                body: (args) => ({ cmd: 'transfer ' + args[0] + ' ' + args[1] + ' ' + args[2] + ' --rpc ' + RPC_URL }),
                cli: KGRAF3_BIN + ' transfer <private_key> <recipient> <amount>' 
            },
            'receive': { 
                desc: 'Generate receive address', 
                params: [], 
                api: LOCAL_API + '/run-cmd',
                method: 'POST',
                body: () => ({ cmd: 'generate' }),
                cli: KGRAF3_BIN + ' generate' 
            },
            'hd-generate': { 
                desc: 'Generate HD wallet', 
                params: [], 
                api: LOCAL_API + '/run-cmd',
                method: 'POST',
                body: () => ({ cmd: 'hd-generate' }),
                cli: KGRAF3_BIN + ' hd-generate' 
            },
            'hd-load': { 
                desc: 'Load HD wallet', 
                params: [{name: 'seed', default: ''}], 
                api: LOCAL_API + '/run-cmd',
                method: 'POST',
                body: (args) => ({ cmd: 'hd-load ' + args[0] }),
                cli: KGRAF3_BIN + ' hd-load <seed>' 
            },
            'derive-address': { 
                desc: 'Derive address', 
                params: [{name: 'seed', default: ''}, {name: 'index', default: '0'}], 
                api: LOCAL_API + '/run-cmd',
                method: 'POST',
                body: (args) => ({ cmd: 'derive-address ' + args[0] + ' ' + args[1] }),
                cli: KGRAF3_BIN + ' derive-address <seed> <index>' 
            },
            'derive-many': { 
                desc: 'Derive many addresses', 
                params: [{name: 'seed', default: ''}, {name: 'count', default: '5'}], 
                api: LOCAL_API + '/run-cmd',
                method: 'POST',
                body: (args) => ({ cmd: 'derive-many ' + args[0] + ' ' + args[1] }),
                cli: KGRAF3_BIN + ' derive-many <seed> <count>' 
            },
            'deadman-deploy': { 
                desc: 'Deploy deadman', 
                params: [
                    {name: 'private_key', default: TEST_WALLET.privateKey}, 
                    {name: 'beneficiary', default: ''}, 
                    {name: 'timeout', default: '300'}
                ], 
                api: LOCAL_API + '/transfer',
                method: 'POST',
                body: (args) => ({ privateKey: args[0], recipient: args[1], amount: args[2] }),
                cli: KGRAF3_BIN + ' transfer <key> <addr> <amount>' 
            },
            'deadman-heartbeat': { 
                desc: 'Heartbeat', 
                params: [{name: 'private_key', default: TEST_WALLET.privateKey}], 
                api: LOCAL_API + '/transfer',
                method: 'POST',
                body: (args) => ({ privateKey: args[0], recipient: '<beneficiary>', amount: '0' }),
                cli: KGRAF3_BIN + ' transfer <key> <addr> <amount>' 
            },
            'deadman-cancel': { 
                desc: 'Cancel', 
                params: [{name: 'private_key', default: TEST_WALLET.privateKey}], 
                api: LOCAL_API + '/transfer',
                method: 'POST',
                body: (args) => ({ privateKey: args[0], recipient: '<refund_addr>', amount: '100' }),
                cli: KGRAF3_BIN + ' transfer <key> <addr> <amount>' 
            },
            'deadman-claim': { 
                desc: 'Claim funds', 
                params: [{name: 'private_key', default: ''}], 
                api: LOCAL_API + '/transfer',
                method: 'POST',
                body: (args) => ({ privateKey: args[0], recipient: '<claim_addr>', amount: '100' }),
                cli: KGRAF3_BIN + ' transfer <key> <addr> <amount>' 
            },
            'deadman-state': { 
                desc: 'View state', 
                params: [{name: 'address', default: ''}], 
                api: API_BASE + '/addresses/' + encodeURIComponent('') + '/utxos',
                cli: KGRAF3_BIN + ' utxos <address>' 
            },
            'deploy-contract': { 
                desc: 'Deploy contract', 
                params: [
                    {name: 'contract', default: 'deadman'}, 
                    {name: 'private_key', default: TEST_WALLET.privateKey}
                ], 
                api: null,
                cli: 'cd ~/kaspa-node && python3 -m silverscript compile <file>' 
            },
            'graffiti': { 
                desc: 'Send graffiti', 
                params: [
                    {name: 'private_key', default: TEST_WALLET.privateKey}, 
                    {name: 'message', default: ''},
                    {name: 'mime', default: 'text/plain'},
                    {name: 'fee', default: '1000'}
                ], 
                api: LOCAL_API + '/run-cmd',
                method: 'POST',
                body: (args) => ({ cmd: 'graffiti ' + args[0] + ' "' + args[1] + '" ' + args[2] + ' ' + args[3] + ' --rpc ' + RPC_URL }),
                cli: KGRAF3_BIN + ' graffiti <key> <msg> [mime] [fee]' 
            }
        };

        const CATEGORIES = {
            'WALLET': ['load', 'generate', 'balance-tn12', 'balance-tn10', 'utxos', 'send', 'receive', 'graffiti'],
            'DEADMAN': ['deadman-deploy', 'deadman-heartbeat', 'deadman-cancel', 'deadman-claim', 'deadman-state'],
            'CONTRACT': ['deploy-contract'],
            'COMPILER': ['silverc']
        };

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 2000);
        }

        function renderButtons() {
            const container = document.getElementById('chipButtons');
            Object.entries(CATEGORIES).forEach(([cat, cmds]) => {
                const header = document.createElement('div');
                header.className = 'cat-header';
                header.textContent = cat;
                container.appendChild(header);
                const div = document.createElement('div');
                div.className = 'cmd-btns';
                cmds.forEach(cmd => {
                    const btn = document.createElement('button');
                    btn.className = 'chip-btn';
                    btn.textContent = cmd;
                    btn.onclick = () => showParams(cmd);
                    div.appendChild(btn);
                });
                container.appendChild(div);
            });
        }

        function showParams(cmdName) {
            currentCmd = cmdName;
            const cmd = COMMANDS[cmdName];
            const header = document.getElementById('paramsHeader');
            const form = document.getElementById('paramsForm');
            
            header.textContent = cmdName.toUpperCase() + ' PARAMETERS';
            
            if (!cmd.params || cmd.params.length === 0) {
                form.innerHTML = '<div class="info">No parameters. Click RUN.</div><button class="run-btn" onclick="runCommand()">▶ RUN</button>';
            } else {
                let html = '';
                cmd.params.forEach((p, i) => {
                    html += '<div class="param-group"><div class="param-label">' + p.name + '</div><input type="text" class="param-input" id="param-' + i + '" value="' + (p.default || '') + '"></div>';
                });
                html += '<button class="run-btn" onclick="runCommand()">▶ RUN</button>';
                form.innerHTML = html;
            }
            
            // Show command in output
            const output = document.getElementById('cliOutput');
            output.innerHTML = '<div class="cmd">' + cmd.cli + '</div><div class="info">Fill parameters and click RUN</div>';
        }

        async function runCommand() {
            if (!currentCmd) return;
            
            const cmd = COMMANDS[currentCmd];
            const output = document.getElementById('cliOutput');
            
            // Get args
            let args = [];
            if (cmd.params) {
                args = cmd.params.map((p, i) => {
                    const el = document.getElementById('param-' + i);
                    return el ? el.value : p.default;
                });
            }
            
            // Build actual command
            let actualCmd = cmd.cli;
            output.innerHTML = '<div class="cmd">' + actualCmd + '</div>';
            
            try {
                if (cmd.api) {
                    let response;
                    if (cmd.method === 'POST') {
                        const bodyData = cmd.body ? cmd.body(args) : {};
                        response = await fetch(cmd.api, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(bodyData)
                        });
                    } else {
                        // Build URL with args for GET requests
                        let url = cmd.api;
                        if (cmd.params && cmd.params.length > 0 && args[0]) {
                            // Replace :address placeholder
                            url = url.replace(encodeURIComponent(TEST_WALLET.address), encodeURIComponent(args[0] || TEST_WALLET.address));
                            url = url.replace('/addresses//', '/addresses/' + encodeURIComponent(args[0] || ''));
                        }
                        response = await fetch(url);
                    }
                    const data = await response.json();
                    
                    // Handle error response
                    if (data.error) {
                        output.innerHTML += '<div class="error">' + data.error + '</div>';
                    } else {
                        output.innerHTML += '<div class="result">' + JSON.stringify(data, null, 2) + '</div>';
                    }
                    
                    // Handle load/hd-load response - update wallet
                    if ((currentCmd === 'load' || currentCmd === 'hd-load') && data.private_key && data.address) {
                        TEST_WALLET.privateKey = data.private_key;
                        TEST_WALLET.address = data.address;
                        document.getElementById('walletAddress').textContent = data.address;
                        await refreshBalance();
                        showToast('Wallet loaded: ' + data.address);
                    }
                    
                    // Refresh balance after send
                    if (currentCmd === 'send' && !data.error) {
                        await refreshBalance();
                        showToast('Transaction sent!');
                    }
                } else {
                    output.innerHTML += '<div class="info">Run this command in terminal:\n\n' + actualCmd + '</div>';
                }
            } catch (e) {
                output.innerHTML += '<div class="error">Error: ' + e.message + '\n\nMake sure the API server is running:\nnode server.js</div>';
            }
            output.scrollTop = output.scrollHeight;
        }

        function clearOutput() {
            document.getElementById('cliOutput').innerHTML = '<div class="info">Click a command, fill params, click RUN...</div>';
        }

        async function refreshBalance() {
            try {
                document.getElementById('walletAddress').textContent = TEST_WALLET.address;
                const res = await fetch(API_BASE + '/addresses/' + TEST_WALLET.address + '/balance');
                const data = await res.json();
                document.getElementById('walletBalance').textContent = (parseInt(data.balance) / 100000000).toFixed(2) + ' TKAS';
                showToast('Balance refreshed');
            } catch (e) {
                showToast('Error: ' + e.message);
            }
        }

        function updateDateTime() {
            const now = new Date();
            document.getElementById('datetime').textContent = now.toLocaleString();
        }
        setInterval(updateDateTime, 1000);
        updateDateTime();

        renderButtons();
        refreshBalance();
    </script>
</body>
</html>
